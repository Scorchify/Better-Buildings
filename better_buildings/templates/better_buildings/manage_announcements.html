{%extends "better_buildings/base.html" %}
{% block content %}
<div class="box">
<button onclick="location.href='{% url 'better_buildings:create_announcement' %}'" class="btn btn-primary">Create Announcement</button>


{% for announcement in announcements %}
<li class="announcement-item">
  <div class="announcement-content">
    <div class="announcement-text">{{ announcement.text|linebreaks }}</div>
    <div class="announcement-date">{{ announcement.date_added|date:'M d, Y g:i A' }}</div>
  </div>
  <div class="edit-container">
      <a href="{% url 'better_buildings:edit_announcement' announcement.id %}" class="btn btn-primary">Edit Announcement</a>
  </div>
  {% if is_supervisor %}
    <div class="edit-container">
      <form method="post" action="{% url 'better_buildings:announcements' %}">
        {% csrf_token %}
        <input type="hidden" name="announcement_id" value="{{ announcement.id }}">
      </form>
    </div>
  {% endif %}
  <button onclick="deleteAnnouncement({{ announcement.id }})" class="btn btn-danger">Remove</button>
  <button onclick="deleteAnnouncement({{ announcement.id }})" class="btn btn-danger">Resolve</button>
  {% endfor %}
</div>
<script>
    function deleteAnnouncement(announcement_id) {
      var csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
      fetch('{% url 'better_buildings:manage_announcements' %}', {
        method: 'POST',
        headers: {
          'X-CSRFToken': csrftoken,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          'announcement_id': announcement_id
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data['success']) {
          window.location.reload();
        }
      });
    }
} 
</script>

{% endblock content %}
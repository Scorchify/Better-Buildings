{% extends "better_buildings/base.html" %}

{% block content %}
  <section class="py-5 nice-bg">
    <div class="container">
      <h2 class="fw-bold mb-4">Manage Areas</h2>
      <div class="mt-3 mb-3">
        <button onclick="location.href='{% url 'better_buildings:new_area' %}'" class="btn btn-primary">Add an Area</button>
      </div>
      <div class="row mb-4">
        <div class="col">
          <h4 class="mb-3 fw-bold">Areas</h4>
          {% if areas %}
            <ul class="area-list">
              {% for area in areas %}
                <li id="area-{{ area.id }}" class="area-item">
                  <input type="text" value="{{ area.text }}" class="area-textbox" readonly>
                  <div class="button-group">
                    <button onclick="location.href='{% url 'better_buildings:edit_area' area.id %}'" class="btn btn-secondary">Edit</button>
                    <button onclick="deleteArea({{ area.id }})" class="btn btn-danger">Remove</button>
                  </div>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <p>No areas available.</p>
          {% endif %}
        </div>
      </div>
    </div>
  </section>

  <script>
    function deleteArea(areaId) {
      if (confirm('Are you sure you want to delete this area?')) {
        const removeAreaUrl = "{% url 'better_buildings:remove_area' 0 %}".replace('0', areaId);
        fetch(removeAreaUrl, {
          method: 'DELETE',
          headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
            'Content-Type': 'application/json'
          }
        })
        .then(response => {
          if (response.ok) {
            document.getElementById(`area-${areaId}`).remove();
          } else {
            alert('Failed to delete the area.');
          }
        });
      }
    }
  </script>
{% endblock content %}